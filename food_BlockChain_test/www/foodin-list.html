<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="icon/css/all.css">
  <link rel="stylesheet" href="css/time-list.css">
</head>
<body onload="ShowTime()">
  <!--------------------------------------------------導航欄------------------------------------------------------------->
  <div class="nav-box">
    <nav class="nav_bar flex">
        <div class="item"> <i class="fas fa-reply fa-2x" onclick="location.href='main.html'"></i> </div>
        <div class="item flex-2"> <h3>食材進貨管理</h3> </div>
        <div class="item"><i class="fas fa-redo-alt fa-2x" onclick="location.reload()"></i></div>
    </nav>
  </div>
  <div id="nav-btn" class="nav-btn flex">
      <a class="active item" href="javascript:void(0)"><i class="fas fa-truck fa-1x"></i></a>
      <a class="item" href="javascript:void(0)"><i class="fas fa-utensils fa-1x" onclick="location.href='food-list.html'"></i></a>
      <a class="item" href="javascript:void(0)"><i class="fas fa-broom fa-1x" onclick="location.href='kitchen-list.html'"></i></a>
  </div>

  <div id="food-status" class="food-status">
    <table>
      <tr>
        <td>食材</td>
        <td>日期時間</td>
        <td>狀態</td>
      </tr>
      
    </table>
  </div>

  <!--------------------------------------------------footer------------------------------------------------------------>
  <div class="ul_footer">
    <h3 id="showbox"></h3> 
  </div>

  <!--------------------------------------------------time javascript------------------------------------------------------------>

  <script language="JavaScript">
    var NowDate=new Date();
    var year=NowDate.getFullYear();
    var month=NowDate.getMonth()+1;
    var date=NowDate.getDate();
    var hour=NowDate.getHours();
    var min=NowDate.getMinutes();
    var s=NowDate.getSeconds();

    function appendzero(obj){
      if (obj < 10) return "0" + obj;
      else return obj;
    }

    function ShowTime(){
        let time = appendzero(month)+ "-" +appendzero(date) + " " + appendzero(hour) + ":" + appendzero(min)
        document.getElementById('showbox').innerHTML = `更新時間:  ${time}`;
    }
  </script>
     
  <!--------------------------------------------------nav-btn javascript------------------------------------------------------------>
    <script>
      window.onscroll = function() {myFunction()};
      
      var navbar = document.getElementById("nav-btn");
      var sticky = navbar.offsetTop;
      
      function myFunction() {
        if (window.pageYOffset >= sticky) {
          navbar.classList.add("sticky")
        } else {
          navbar.classList.remove("sticky");
        }
      }
    </script>
  <!--------------------------------------------------script------------------------------------------------------------->
  <script>
    function openNav() {
      document.getElementById("mySidenav").style.width = "250px";
    }
    
    function closeNav() {
      document.getElementById("mySidenav").style.width = "0";
    }
  </script>

  <script src="cordova.js"></script>
  <script src="js/index.js"></script>

  <!-- webSocket connect -->
  <script>
    var ws = new WebSocket("ws://192.168.50.78:6001");

    ws.onopen = function () {
        console.log('open');
        ws.send(3);
    };
    
    var datas = [];
    ws.onmessage = function (event) {
        datas.push(event.data);
        if(datas[0] == "check"){
          ws.send(localStorage.address);
        }
        console.log(datas)
        //從python傳進來的值會長 --> [1630734778, 1630734813]
        //放入datas arr裡後 --> ['[1630734778, 1630734813]']
        //進行處理
        for (var i=1; i<datas.length; i++) {
            if(i==1){
                var data = datas[1].toString();
                // console.log(data);
                var sData = data.replace("[", "");
                var sData2 = sData.replace("]", "");
                var words = sData2.split(', ');
                // console.log(words[1]);
            }
            else if(i==2){
                var data2 = datas[2].toString();
                // console.log(data2);
                var sData3 = data2.replace("[", "");
                var sData4 = sData3.replace("]", "");
                var sData5 = sData4.replace(/["]+/g, '');
                var words2 = sData5.split(', ');
                // console.log(words2[1]);
            }
        }
        console.log(datas);
        console.log(event.data);

        if(datas.length == 3){
            var tbody = document.querySelector('tbody');
            for (var i=0; i<words.length; i++) { 
                var tr = document.createElement('tr');
                tbody.appendChild(tr);

                if(words[i] == ""){
                  //<td>id</td>
                  var td = document.createElement('td');
                  td.innerHTML = "無資料";
                  tr.appendChild(td);
                  //unixTime 轉換
                  //<td>unixTime</td>
                  var td2 = document.createElement('td');
                  td2.innerHTML = "無資料";
                  tr.appendChild(td2);
                  //<td>狀態</td>
                  var td3 = document.createElement('td');
                  td3.innerHTML = "無資料";
                  tr.appendChild(td3);
                }
                else{
                  //<td>id</td>
                  var td = document.createElement('td');
                  td.innerHTML = words2[i];
                  tr.appendChild(td);
                  //unixTime 轉換
                  //<td>unixTime</td>
                  var td2 = document.createElement('td');
                  var date = new Date(parseInt(words[i])*1000);
                  td2.innerHTML = date.toLocaleString();
                  tr.appendChild(td2);
                  //<td>狀態</td>
                  var td3 = document.createElement('td');
                  td3.innerHTML = "進貨";
                  tr.appendChild(td3);
                }
            }
        }
        
    };
  </script>
</body>
</html> 