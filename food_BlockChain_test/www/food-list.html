<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="icon/css/all.css">
  <link rel="stylesheet" href="css/food-list.css">
</head>
<body onload="ShowTime()">
  <!--------------------------------------------------導航欄------------------------------------------------------------->
  <nav class="nav_bar flex">
    <div class="item"> <i class="fas fa-reply fa-2x" onclick="location.href='time-list.html'"></i> </div>
    <div class="item flex-2"> <h3>食材清洗</h3> </div>
    <div class="item"><i class="fas fa-redo-alt fa-2x" onclick="location.href='food-list.html'"></i></div>
  </nav>

  <!--------------------------------------------------登入------------------------------------------------------------->
  <div id="food-status" class="food-status">
    <table>
      <tr>
        <td>食材</td>
        <td>日期時間</td>
        <td>狀態</td>
      </tr>
          
    </table>
  </div>

  <div class="ul_footer">
      <span id="loading-time" class="loading-time">
          <h3>更新時間 :</h3>
      </span>
      <h3 id="showbox"></h3> 
  </div>

  <!--------------------------------------------------script------------------------------------------------------------->
  <script>
    function openNav() {
      document.getElementById("mySidenav").style.width = "250px";
    }
    
    function closeNav() {
      document.getElementById("mySidenav").style.width = "0";
    }
  </script>

  <script src="cordova.js"></script>
  <script src="js/index.js"></script>

  <!-- webSocket connect -->
  <script>
    var ws = new WebSocket("ws://192.168.68.53:6001");

    ws.onopen = function () {
        console.log('open');
        ws.send(4);
    };
    
    var datas = [];
    ws.onmessage = function (event) {
        datas.push(event.data);
        if(datas[0] == "check"){
          ws.send(localStorage.address);
        }
        
        //從python傳進來的值會長 --> [1630734778, 1630734813]
        //放入datas arr裡後 --> ['[1630734778, 1630734813]']
        //進行處理
        for (var i=1; i<datas.length; i++) {
            if(i==1){
                var data = datas[1].toString();
                // console.log(data);
                var sData = data.replace("[", "");
                var sData2 = sData.replace("]", "");
                var words = sData2.split(', ');
                // console.log(words[1]);
            }
            else if(i==2){
                var data2 = datas[2].toString();
                // console.log(data2);
                var sData3 = data2.replace("[", "");
                var sData4 = sData3.replace("]", "");
                var sData5 = sData4.replace(/["]+/g, '');
                var words2 = sData5.split(', ');
                // console.log(words2[1]);
            }
        }
        console.log(datas);
        console.log(event.data);

        if(datas.length == 3){
            var tbody = document.querySelector('tbody');
            for (var i=0; i<words.length; i++) { 
                var tr = document.createElement('tr');
                tbody.appendChild(tr);
                //<td>id</td>
                var td = document.createElement('td');
                td.innerHTML = words2[i];
                tr.appendChild(td);
                
                if(words[i] == "0"){
                    var td2 = document.createElement('td');
                    td2.innerHTML = "0";
                    tr.appendChild(td2);
                    var td3 = document.createElement('td');
                    td3.innerHTML = "未清洗";
                    tr.appendChild(td3);
                }
                else if(words[i] != "0"){
                    var td2 = document.createElement('td');
                    var date = new Date(parseInt(words[i])*1000);
                    td2.innerHTML = date.toLocaleString();
                    tr.appendChild(td2);
                    var td3 = document.createElement('td');
                    td3.innerHTML = "清洗";
                    tr.appendChild(td3);
                }      
            }
        }
        
    };
  </script>

  <script language="JavaScript">
      function ShowTime(){
          var NowDate=new Date();
          var m1=NowDate.getMonth()+1;
          var d=NowDate.getDate();
          var h=NowDate.getHours();
          var m=NowDate.getMinutes();
          var s=NowDate.getSeconds();　
          document.getElementById('showbox').innerHTML = `${m1} 月 ${d} 號 ${h} 時 ${m} 分`;
      }
  </script>

</body>
</html> 
